<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Dr Abdulla">
  <meta name="description" content="Complete Guide to Efficiency & Productivity Estimation: DEA, SFA, Malmquist, Bootstrapped, Metafrontier — with Full Stata Code">
  <title>Efficiency & Productivity Estimation | Dr Abdulla</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Iskoola+Pota:wght@700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Particles.js -->
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

  <!-- Prism.js for Code Highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

  <!-- Open Graph -->
  <meta property="og:title" content="Efficiency & Productivity Estimation | Dr Abdulla">
  <meta property="og:description" content="DEA, SFA, Malmquist, Bootstrapped DEA, Metafrontier — Full Stata code + diagnostics">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://abdullahalig007.github.io/website/Efficiency & Productivity Estimation.html">
  <meta property="og:image" content="https://abdullahalig007.github.io/website/ph.jpg">

  <!-- Twitter Cards -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Efficiency & Productivity Estimation | Dr Abdulla">
  <meta name="twitter:description" content="Full guide with Stata code, graphs, and interpretation">
  <meta name="twitter:image" content="https://abdullahalig007.github.io/website/ph.jpg">

  <style>
    :root {
      --bg: #0f172a;
      --text: #f1f5f9;
      --card: rgba(30, 41, 59, 0.7);
      --border: rgba(148, 163, 184, 0.2);
      --accent: #4f46e5;
      --accent-2: #10b981;
      --hover: #6366f1;
      --particle: #64748b;
      --particle-line: #475569;
    }

    .light-mode {
      --bg: #f8fafc;
      --text: #1e293b;
      --card: rgba(255, 255, 255, 0.8);
      --border: rgba(100, 116, 139, 0.2);
      --accent: #4338ca;
      --accent-2: #059669;
      --hover: #4f46e5;
      --particle: #94a3b8;
      --particle-line: #cbd5e1;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: all 0.4s ease;
      line-height: 1.7;
      overflow-x: hidden;
    }

    h1, h2, h3, h4, .section-title {
      font-family: 'Iskoola Pota', Georgia, serif;
      font-weight: 700;
      letter-spacing: -0.03em;
    }

    /* Particles */
    #particles-js {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      pointer-events: none;
    }

    /* Hero */
    .hero {
      background: linear-gradient(135deg, var(--bg) 0%, var(--accent) 100%);
      position: relative;
      overflow: hidden;
      clip-path: polygon(0 0, 100% 0, 100% 85%, 0 100%);
      color: white;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    /* Glass Card */
    .glass-card {
      background: var(--card);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: 1rem;
      transition: all 0.4s ease;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    }

    .glass-card:hover {
      transform: translateY(-12px) rotateX(2deg);
      box-shadow: 0 20px 40px rgba(79, 70, 229, 0.2);
      border-color: var(--accent);
    }

    /* Nav */
    .nav-link {
      position: relative;
      color: var(--text);
      font-weight: 500;
      transition: color 0.3s;
    }

    .nav-link::after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(to right, var(--accent), var(--accent-2));
      transition: width 0.3s ease;
    }

    .nav-link:hover::after, .nav-link.active::after {
      width: 100%;
    }

    .nav-link:hover, .nav-link.active {
      color: var(--accent);
    }

    /* Mobile Menu */
    #mobile-menu {
      transition: transform 0.4s ease;
      transform: translateX(100%);
    }

    #mobile-menu.open {
      transform: translateX(0);
    }

    /* Tilt */
    .tilt {
      transition: transform 0.3s ease;
    }

    /* Collapse */
    .collapse-btn {
      cursor: pointer;
      font-weight: 600;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: .5rem;
      font-size: 1.25rem;
    }
    .collapse-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height .6s ease;
    }
    .collapse-content.open {
      max-height: 50000px;
    }

    /* Code Styling (Prism Override) */
    pre[class*=language-] {
      background: var(--card) !important;
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow-x: auto;
      margin: 1rem 0;
      font-size: .9rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .copy-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: var(--accent);
      color: white;
      border: none;
      padding: 4px 8px;
      font-size: .8rem;
      border-radius: 4px;
      cursor: pointer;
      transition: 0.3s;
    }
    .copy-btn:hover {
      background: var(--hover);
    }

    /* Search */
    #search-input {
      width: 100%;
      padding: .75rem;
      border-radius: .5rem;
      background: var(--card);
      color: var(--text);
      border: 1px solid var(--border);
      transition: .3s;
    }
    #search-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
    }

    /* Download Btn */
    .download-btn {
      display: inline-flex;
      align-items: center;
      gap: .5rem;
      padding: .5rem 1rem;
      background: linear-gradient(to right, var(--accent), var(--accent-2));
      color: white;
      border-radius: .5rem;
      font-size: .875rem;
      text-decoration: none;
      margin-top: .5rem;
      box-shadow: 0 4px 6px rgba(0,0,0,.1);
      transition: 0.3s;
    }
    .download-btn:hover {
      background: linear-gradient(to right, var(--hover), var(--accent-2));
      transform: translateY(-2px);
    }

    /* Badge */
    .badge {
      padding: .25rem .5rem;
      font-size: .75rem;
      border-radius: 9999px;
      font-weight: 600;
    }
    .badge-dea { background: #3b82f6; color: white; }
    .badge-sfa { background: #a855f7; color: white; }
    .badge-cost { background: #ef4444; color: white; }
    .badge-prod { background: #059669; color: white; }
    .badge-adv { background: #eab308; color: white; }

    /* Output */
    .output {
      background: var(--card);
      color: var(--text);
      padding: 1rem;
      border-radius: 8px;
      margin-top: 1rem;
      font-family: monospace;
      white-space: pre-wrap;
      font-size: .9rem;
      border: 1px solid var(--border);
    }

    /* Note */
    .note {
      font-size: .875rem;
      font-style: italic;
      color: #94a3b8;
      margin-top: 1rem;
    }
  </style>
</head>

<body class="min-h-screen">

  <!-- Animated Particles -->
  <div id="particles-js"></div>

  <!-- Hero -->
  <section class="hero py-32 text-center relative">
    <div class="container mx-auto px-6">
      <h1 class="text-5xl md:text-7xl font-bold mb-4">Efficiency & Productivity</h1>
      <p class="text-xl md:text-2xl font-light mb-2">Full Guide: DEA, SFA, Malmquist, Bootstrapped, Metafrontier</p>
      <p class="text-lg opacity-90">by Dr Abdulla</p>
    </div>
  </section>

  <!-- Navigation -->
  <header class="sticky top-0 z-50 bg-slate-900/80 backdrop-blur-lg border-b border-slate-700">
    <div class="container mx-auto px-6 py-4 flex justify-between items-center">
      <a href="/website/" class="flex items-center space-x-2">
        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-emerald-500 flex items-center justify-center text-white font-bold text-lg">
          DA
        </div>
      </a>

      <nav class="hidden md:flex items-center space-x-8">
        <a href="/website/cv.html" class="nav-link"><i class="fas fa-file-alt mr-1"></i> CV</a>
        <a href="/website/" class="nav-link"><i class="fas fa-user mr-1"></i> About</a>
        <a href="/website/research.html" class="nav-link"><i class="fas fa-flask mr-1"></i> Research</a>
        <a href="/website/teaching.html" class="nav-link"><i class="fas fa-chalkboard-teacher mr-1"></i> Teaching</a>
        <a href="/website/resource.html" class="nav-link"><i class="fas fa-book mr-1"></i> Resources</a>
        <a href="/website/learning-resources.html" class="nav-link"><i class="fas fa-graduation-cap mr-1"></i> Learning</a>
        <a href="/website/Efficiency & Productivity Estimation.html" class="nav-link active"><i class="fas fa-chart-line mr-1"></i> Efficiency & Productivity
</a>
        <button id="theme-toggle" class="ml-4 p-2 rounded-full hover:bg-slate-700 transition">
          <i class="fas fa-moon"></i>
        </button>
      </nav>

      <button id="mobile-toggle" class="md:hidden text-white">
        <i class="fas fa-bars text-xl"></i>
      </button>
    </div>
  </header>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="fixed inset-0 bg-slate-900/95 backdrop-blur-md z-40 flex flex-col items-center justify-center space-y-6 text-2xl">
    <button id="mobile-close" class="absolute top-6 right-6 text-white">
      <i class="fas fa-times"></i>
    </button>
    <a href="/website/cv.html" class="nav-link">CV</a>
    <a href="/website/" class="nav-link">About</a>
    <a href="/website/research.html" class="nav-link">Research</a>
    <a href="/website/teaching.html" class="nav-link">Teaching</a>
    <a href="/website/resource.html" class="nav-link">Resources</a>
    <a href="/website/learning-resources.html" class="nav-link">Learning</a>
    <a href="/website/Efficiency & Productivity Estimation.html" class="nav-link">Efficiency</a>
  </div>

  <!-- Main Content -->
  <main class="container mx-auto px-6 py-16 relative z-10">

    <!-- Search -->
    <section class="mb-10">
      <input type="text" id="search-input" placeholder="Search DEA, SFA, Malmquist, bootstrap, metafrontier..." class="w-full">
      <div id="search-results" class="mt-4"></div>
    </section>

    <!-- 0. Generate Data -->
    <section class="mb-12 glass-card p-8 tilt">
      <h3 class="collapse-btn text-xl"><i class="fas fa-chevron-down"></i> 0. Generate Synthetic Panel Data (run once)</h3>
      <div class="collapse-content mt-4">
        <p class="mb-3"><strong>Why?</strong> 200 farms × 5 years. Realistic inefficiency, prices, regions.</p>
        <pre><code class="language-stata">* -------------------------------------------------
* 0. CREATE SYNTHETIC PANEL DATA
* -------------------------------------------------
clear all
set seed 13579
set obs 1000
gen farmid = ceil(_n/5)
gen year   = 2018 + mod(_n-1,5)
gen region = ceil(runiform()*3)
gen education = runiform(6,18)
gen rain      = 800 + rnormal(0,150)

gen ln_l = ln(20 + rnormal(0,5))
gen ln_k = ln(50 + rnormal(0,12))
gen ln_l2 = ln_l^2
gen ln_k2 = ln_k^2
gen ln_lk = ln_l*ln_k

gen u = abs(rnormal(0,0.3))
gen v = rnormal(0,0.15)

gen ln_y_true = 2.5 + 0.4*ln_l + 0.3*ln_k - 0.05*ln_l2 - 0.04*ln_k2 + 0.06*ln_lk - u + v
gen yield = exp(ln_y_true)

gen wage   = cond(region==1, 120, cond(region==2, 140, 160)) + rnormal(0,10)
gen rental = cond(region==1, 300, cond(region==2, 350, 400)) + rnormal(0,20)

gen labor  = exp(ln_l)
gen capital= exp(ln_k)
gen total_cost = wage*labor + rental*capital

save "farm_data.dta", replace
        </code></pre>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <a href="#" id="data-do" class="download-btn">0_generate_data.do</a>
      </div>
    </section>

    <!-- 1. DEA VRS/CRS -->
    <section class="mb-12 glass-card p-8 tilt">
      <h3 class="collapse-btn text-xl"><i class="fas fa-chevron-down"></i> 1. DEA: VRS vs CRS + Scale Efficiency <span class="badge badge-dea ml-2">Scale Efficiency</span></h3>
      <div class="collapse-content mt-4">
        <p class="mb-3">DEA is non-parametric. Scale Efficiency = TE<sub>CRS</sub> / TE<sub>VRS</sub>.</p>
        <table class="w-full border-collapse">
          <thead>
            <tr>
              <th class="bg-indigo-600 text-white p-4">TE</th>
              <th class="bg-indigo-600 text-white p-4">Interpretation</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-slate-700 p-4">1</td>
              <td class="border border-slate-700 p-4">Fully efficient</td>
            </tr>
            <tr>
              <td class="border border-slate-700 p-4">0.8–0.99</td>
              <td class="border border-slate-700 p-4">Moderately inefficient</td>
            </tr>
            <tr>
              <td class="border border-slate-700 p-4">&lt; 0.8</td>
              <td class="border border-slate-700 p-4">Highly inefficient</td>
            </tr>
          </tbody>
        </table>
        <pre><code class="language-stata">* VRS
use "farm_data.dta", clear
keep if year==2022
dea labor capital = yield, rts(vrs) saving(dea_vrs, replace)
rename te te_vrs
keep farmid te_vrs
save dea_vrs, replace

* CRS
use "farm_data.dta", clear
keep if year==2022
dea labor capital = yield, rts(crs) saving(dea_crs, replace)
rename te te_crs
keep farmid te_crs
save dea_crs, replace

* Merge
use dea_vrs, clear
merge 1:1 farmid using dea_crs, nogen
gen se = te_crs / te_vrs
summarize te_vrs te_crs se, detail
list farmid te_vrs te_crs se in 1/15

* Graphs
histogram te_vrs, freq normal title("TE – VRS") name(vrs, replace)
histogram te_crs, freq normal title("TE – CRS") name(crs, replace)
histogram se, freq normal title("Scale Efficiency") name(se, replace)
graph combine vrs crs se, cols(3) title("DEA Diagnostics")
graph export "dea_diagnostics.pdf", replace
        </code></pre>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <a href="#" id="dea-do" class="download-btn">1_dea_scale.do</a>
        <div class="output">farmid   te_vrs   te_crs       se
   1     1.0000   0.9231   0.9231
   2     0.9873   0.9124   0.9242
   3     0.9541   0.8812   0.9235
...</div>
      </div>
    </section>

    <!-- 2. DEA Cost -->
    <section class="mb-12 glass-card p-8 tilt">
      <h3 class="collapse-btn text-xl"><i class="fas fa-chevron-down"></i> 2. DEA Cost + Allocative Efficiency <span class="badge badge-cost ml-2">Cost Minimization</span></h3>
      <div class="collapse-content mt-4">
        <p class="mb-3">Cost Efficiency = min cost / observed cost. AE = CE / TE.</p>
        <pre><code class="language-stata">use "farm_data.dta", clear
keep if year==2022
gen total_cost = wage*labor + rental*capital

* Technical (VRS)
merge 1:1 farmid using dea_vrs, nogen
rename te_vrs te_tech

* Cost DEA
dea total_cost = yield, rts(vrs) saving(costdea, replace)
rename te ce
keep farmid ce total_cost
tempfile cost
save `cost'

use dea_vrs, clear
merge 1:1 farmid using `cost', nogen
gen ae = ce / te_tech
summarize te_tech ce ae, detail
list farmid te_tech ce ae in 1/10

twoway (scatter ce te_tech), ytitle("Cost Efficiency") xtitle("Technical Efficiency")
graph export "cost_vs_tech.pdf", replace
        </code></pre>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <a href="#" id="cost-do" class="download-btn">2_dea_cost.do</a>
      </div>
    </section>

    <!-- 3. SFA Production -->
    <section class="mb-12 glass-card p-8 tilt">
      <h3 class="collapse-btn text-xl"><i class="fas fa-chevron-down"></i> 3. SFA Production – Translog <span class="badge badge-sfa ml-2">Parametric</span></h3>
      <div class="collapse-content mt-4">
        <p class="mb-3">Flexible form. TE = exp(–u).</p>
        <pre><code class="language-stata">use "farm_data.dta", clear
keep if year==2022
gen ln_y = ln(yield)
gen ln_l = ln(labor)
gen ln_k = ln(capital)

sfcross ln_y ln_l ln_k c.ln_l#c.ln_l c.ln_l#c.ln_k c.ln_k#c.ln_k, dist(tnormal) vhet(rain) uhet(education) emean(education)
predict te_sfa, te
summarize te_sfa
histogram te_sfa, freq normal kdensity title("SFA TE")
graph export "sfa_te_dist.pdf", replace
        </code></pre>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <a href="#" id="sfa-prod-do" class="download-btn">3_sfa_translog.do</a>
      </div>
    </section>

    <!-- 4. SFA Cost -->
    <section class="mb-12 glass-card p-8 tilt">
      <h3 class="collapse-btn text-xl"><i class="fas fa-chevron-down"></i> 4. SFA Cost Frontier</h3>
      <div class="collapse-content mt-4">
        <p class="mb-3">Cost function with inefficiency.</p>
        <pre><code class="language-stata">use "farm_data.dta", clear
keep if year==2022
gen ln_c = ln(wage*labor + rental*capital)
gen ln_y = ln(yield)
gen ln_w = ln(wage)
gen ln_r = ln(rental)

sfcross ln_c ln_y ln_w ln_r c.ln_y#c.ln_w c.ln_y#c.ln_r c.ln_w#c.ln_r, cost dist(hnormal)
predict ce_sfa, te
summarize ce_sfa
        </code></pre>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <a href="#" id="sfa-cost-do" class="download-btn">4_sfa_cost.do</a>
      </div>
    </section>

    <!-- 5. Panel SFA -->
    <section class="mb-12 glass-card p-8 tilt">
      <h3 class="collapse-btn text-xl"><i class="fas fa-chevron-down"></i> 5. Panel SFA: BC95</h3>
      <div class="collapse-content mt-4">
        <p class="mb-3">Separates persistent and transient inefficiency.</p>
        <pre><code class="language-stata">use "farm_data.dta", clear
xtset farmid year
gen ln_y = ln(yield)
gen ln_l = ln(labor)
gen ln_k = ln(capital)

sfpanel ln_y ln_l ln_k, model(bc95) uhet(education) vhet(rain) timetrend
predict te_persistent, tebc
predict te_transient, jlms
gen te_total = te_persistent * te_transient
bysort year: sum te_total
        </code></pre>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <a href="#" id="panel-do" class="download-btn">5_panel_sfa_bc95.do</a>
      </div>
    </section>

    <!-- 6. Malmquist -->
    <section class="mb-12 glass-card p-8 tilt">
      <h3 class="collapse-btn text-xl"><i class="fas fa-chevron-down"></i> 6. Malmquist Index <span class="badge badge-prod ml-2">TFP Growth</span></h3>
      <div class="collapse-content mt-4">
        <p class="mb-3">TFPCH = EC × TC.</p>
        <pre><code class="language-stata">ssc install malmq, replace
use "farm_data.dta", clear
malmq labor capital = yield, rts(vrs) time(year) id(farmid) saving(malmq_out, replace)
use malmq_out, clear
bysort t: sum tfpch ec tc
        </code></pre>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <a href="#" id="malm-do" class="download-btn">6_malmquist.do</a>
      </div>
    </section>

    <!-- 7. Luenberger -->
    <section class="mb-12 glass-card p-8 tilt">
      <h3 class="collapse-btn text-xl"><i class="fas fa-chevron-down"></i> 7. Luenberger Indicator <span class="badge badge-adv ml-2">Additive</span></h3>
      <div class="collapse-content mt-4">
        <p class="mb-3">Handles zeros/negatives.</p>
        <pre><code class="language-stata">ssc install luenberger, replace
luenberger labor capital = yield, time(year) id(farmid) saving(luen_out, replace)
use luen_out, clear
bysort t: sum luen
        </code></pre>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <a href="#" id="luen-do" class="download-btn">7_luenberger.do</a>
      </div>
    </section>

    <!-- 8. Bootstrapped DEA -->
    <section class="mb-12 glass-card p-8 tilt">
      <h3 class="collapse-btn text-xl"><i class="fas fa-chevron-down"></i> 8. Bootstrapped DEA <span class="badge badge-adv ml-2">CIs</span></h3>
      <div class="collapse-content mt-4">
        <p class="mb-3">Bias-corrected TE with 95% CI.</p>
        <pre><code class="language-stata">ssc install deaboot, replace
use "farm_data.dta", clear
keep if year==2022
deaboot labor capital = yield, rts(vrs) reps(2000) dots saving(boot_out, replace)
use boot_out, clear
gen te_bc = te_original - (_b_te - te_original)
        </code></pre>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <a href="#" id="boot-do" class="download-btn">8_deaboot.do</a>
      </div>
    </section>

    <!-- 9. Metafrontier -->
    <section class="mb-12 glass-card p-8 tilt">
      <h3 class="collapse-btn text-xl"><i class="fas fa-chevron-down"></i> 9. Metafrontier</h3>
      <div class="collapse-content mt-4">
        <p class="mb-3">TGR = TE<sub>group</sub> / TE<sub>meta</sub>.</p>
        <pre><code class="language-stata">ssc install metafrontier, replace
use "farm_data.dta", clear
keep if year==2022
metafrontier labor capital = yield, group(region) rts(vrs) saving(meta_out, replace)
use meta_out, clear
gen tgr = te_group / te_meta
bysort region: sum tgr
        </code></pre>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        <a href="#" id="meta-do" class="download-btn">9_metafrontier.do</a>
      </div>
    </section>

  </main>

  <!-- Footer -->
  <footer class="py-12 text-center border-t border-slate-700 mt-20 relative z-10">
    <p class="text-lg font-bold mb-4" style="color: var(--accent-2);">Agricultural Economics</p>
    <div class="flex justify-center space-x-8 text-2xl mb-6">
      <a href="mailto:abdullahalig007@gmail.com" class="hover:text-indigo-400 transition"><i class="fas fa-envelope"></i></a>
      <a href="https://x.com/abdullahalig07" class="hover:text-indigo-400 transition"><i class="fab fa-twitter"></i></a>
      <a href="https://www.researchgate.net/profile/Dr-Abdulla" class="hover:text-indigo-400 transition"><i class="fab fa-researchgate"></i></a>
      <a href="https://www.linkedin.com/in/dr-abdulla-00793160/" class="hover:text-indigo-400 transition"><i class="fab fa-linkedin"></i></a>
      <a href="https://orcid.org/0000-0002-6544-1056" class="hover:text-indigo-400 transition"><i class="fab fa-orcid"></i></a>
      <a href="https://scholar.google.com/citations?user=6CE-0s8AAAAJ" class="hover:text-indigo-400 transition"><i class="fas fa-graduation-cap"></i></a>
    </div>
    <p class="text-sm opacity-70">© 2025 Dr Abdulla. All rights reserved.</p>
  </footer>

  <!-- Scripts -->
  <script>
    // === PARTICLES.JS ===
    particlesJS('particles-js', {
      "particles": {
        "number": { "value": 80, "density": { "enable": true, "value_area": 800 } },
        "color": { "value": getComputedStyle(document.documentElement).getPropertyValue('--particle').trim() },
        "shape": { "type": "circle" },
        "opacity": { "value": 0.5, "random": true },
        "size": { "value": 3, "random": true },
        "line_linked": {
          "enable": true,
          "distance": 150,
          "color": getComputedStyle(document.documentElement).getPropertyValue('--particle-line').trim(),
          "opacity": 0.3,
          "width": 1
        },
        "move": {
          "enable": true,
          "speed": 2,
          "direction": "none",
          "random": false,
          "straight": false,
          "out_mode": "out",
          "bounce": false
        }
      },
      "interactivity": {
        "detect_on": "canvas",
        "events": {
          "onhover": { "enable": true, "mode": "grab" },
          "onclick": { "enable": true, "mode": "push" },
          "resize": true
        },
        "modes": {
          "grab": { "distance": 140, "line_linked": { "opacity": 0.7 } },
          "push": { "particles_nb": 4 }
        }
      },
      "retina_detect": true
    });

    // === THEME TOGGLE + PARTICLE SYNC ===
    const toggle = document.getElementById('theme-toggle');
    const body = document.body;
    const icon = toggle.querySelector('i');

    function updateParticles() {
      const particleColor = getComputedStyle(document.documentElement).getPropertyValue('--particle').trim();
      const lineColor = getComputedStyle(document.documentElement).getPropertyValue('--particle-line').trim();
      if (window.pJSDom && window.pJSDom[0]) {
        window.pJSDom[0].pJS.particles.color.value = particleColor;
        window.pJSDom[0].pJS.particles.line_linked.color = lineColor;
        window.pJSDom[0].pJS.fn.particlesRefresh();
      }
    }

    if (localStorage.getItem('theme') === 'light') {
      body.classList.add('light-mode');
      icon.classList.replace('fa-moon', 'fa-sun');
    }

    toggle.addEventListener('click', () => {
      body.classList.toggle('light-mode');
      const isLight = body.classList.contains('light-mode');
      icon.classList.toggle('fa-sun', isLight);
      icon.classList.toggle('fa-moon', !isLight);
      localStorage.setItem('theme', isLight ? 'light' : 'dark');
      setTimeout(updateParticles, 100);
    });

    // === MOBILE MENU ===
    document.getElementById('mobile-toggle').addEventListener('click', () => {
      document.getElementById('mobile-menu').classList.add('open');
    });
    document.getElementById('mobile-close').addEventListener('click', () => {
      document.getElementById('mobile-menu').classList.remove('open');
    });

    // === 3D TILT ===
    document.querySelectorAll('.tilt').forEach(card => {
      card.addEventListener('mousemove', e => {
        const rect = card.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        const rotateX = (y - centerY) / 10;
        const rotateY = (centerX - x) / 10;
        card.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
      });
      card.addEventListener('mouseleave', () => {
        card.style.transform = '';
      });
    });

    // === ACTIVE NAV ===
    document.querySelectorAll('.nav-link').forEach(link => {
      if (link.href === location.href) link.classList.add('active');
    });

    // === COLLAPSE ===
    document.querySelectorAll('.collapse-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const content = btn.nextElementSibling;
        const chev = btn.querySelector('i');
        content.classList.toggle('open');
        chev.classList.toggle('fa-chevron-down');
        chev.classList.toggle('fa-chevron-up');
      });
    });

    // === SEARCH ===
    const searchIn = document.getElementById('search-input');
    const results = document.getElementById('search-results');
    searchIn.addEventListener('input', e => {
      const q = e.target.value.toLowerCase().trim();
      results.innerHTML = '';
      if (q.length < 2) return;
      document.querySelectorAll('h3, code, p, td').forEach(el => {
        if (el.innerText.toLowerCase().includes(q)) {
          const card = document.createElement('div');
          card.className = 'p-3 bg-slate-800/50 rounded mb-2 text-sm cursor-pointer hover:bg-slate-700/50';
          const title = el.tagName === 'H3' ? el.innerText : el.innerText.split('\n')[0];
          card.innerHTML = `<strong>${title}</strong><p class="text-gray-400">${el.closest('.collapse-content')?.innerText.slice(0,180)}...</p>`;
          card.onclick = () => el.scrollIntoView({behavior:'smooth'});
          results.appendChild(card);
        }
      });
    });

    // === COPY CODE ===
    function copyCode(btn) {
      const code = btn.parentElement.querySelector('code').innerText;
      navigator.clipboard.writeText(code).then(() => {
        const orig = btn.textContent;
        btn.textContent = 'Copied!';
        setTimeout(() => btn.textContent = orig, 2000);
      });
    }

    // === DOWNLOAD .DO FILES ===
    const doFiles = {};
    document.querySelectorAll('pre code').forEach((code, index) => {
      doFiles[`${index}_code.do`] = code.innerText;
      const link = code.parentElement.nextElementSibling.nextElementSibling;
      if (link) {
        const blob = new Blob([code.innerText], {type: 'text/plain'});
        link.href = URL.createObjectURL(blob);
        link.download = link.textContent;
      }
    });

    updateParticles();
  </script>
</body>
</html>

